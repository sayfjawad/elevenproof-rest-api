import org.openapitools.generator.gradle.plugin.tasks.GenerateTask

plugins {
    alias libs.plugins.openApiGenerator
    alias libs.plugins.springBoot
    alias libs.plugins.springBootDependencyManagement
    alias libs.plugins.piTest apply false
}

repositories {
    mavenCentral()
}

dependencies {
    implementation libs.springBootWeb
    implementation libs.swaggerAnnotations
    implementation libs.jacksonDatabindNullable
    implementation libs.javaxAnnotationApi
    implementation libs.gson
    implementation libs.validationApi
    implementation 'com.squareup.okhttp3:okhttp:4.9.3' // Add OkHttp dependency
    implementation 'com.squareup.okio:okio:2.10.0' // Add Okio dependency
    implementation 'com.squareup.okhttp3:logging-interceptor:4.9.3'
    // Add OkHttp logging interceptor
    implementation 'io.gsonfire:gson-fire:1.8.5' // Add GsonFire dependency
    implementation 'javax.ws.rs:javax.ws.rs-api:2.1.1' // Add JAX-RS dependency
    compileOnly 'org.openapitools:openapi-generator-cli:7.7.0'
    compileOnly 'org.projectlombok:lombok:1.18.24' // Add Lombok dependency
    annotationProcessor 'org.projectlombok:lombok:1.18.24' // Add Lombok annotation processor

}

// Ensure the generated sources are compiled
sourceSets.main.java.srcDir "${projectDir}/build/generated/src/main/java"

// Ensure the clean task deletes the generated files
clean {
    delete "${projectDir}/build/generated"
}
// Disable bootJar task
bootJar {
    enabled = false
}

// Enable jar task
jar {
    enabled = true
}
// Define the generateOpenApi task
tasks.register('generateOpenApi', GenerateTask) {
    generatorName = "java"
    inputSpec = "${projectDir}/src/main/resources/apispecs/api-specs.yaml"
    outputDir = "${projectDir}/build/generated"
    modelPackage = "nl.multicode.elevenproof.openapi.model"
    configOptions = [
            "dateLibrary": "java8"
    ]
    generateApiDocumentation = false
    generateModelDocumentation = false
}

// Ensure the openApiGenerate task runs before compileJava
compileJava.dependsOn generateOpenApi

// Ensure the openApiGenerate task runs before classes
classes.dependsOn generateOpenApi

// Ensure the generateOpenApi task runs after clean
generateOpenApi.mustRunAfter clean
