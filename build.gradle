// Root build.gradle

plugins {
    id 'java'
    alias libs.plugins.springBoot apply false
    alias libs.plugins.springBootDependencyManagement apply false
}

allprojects {
    group = 'nl.multicode.elevenproof'
    version = '1.0-SNAPSHOT'
    sourceCompatibility = '17'

    repositories {
        mavenCentral()
    }

    apply plugin: 'java'
    apply plugin: 'io.spring.dependency-management'

    tasks.withType(JavaCompile) {
        options.encoding = 'UTF-8'
    }

    tasks.named('test') {
        useJUnitPlatform()
    }

    dependencyManagement {
        imports {
            mavenBom "org.springframework.boot:spring-boot-dependencies:${libs.versions.springBoot}"
        }
    }

    dependencies {
        compileOnly libs.lombok
        annotationProcessor libs.lombok
    }
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'io.spring.dependency-management'
}

dependencies {
    testImplementation libs.junitJupiterEngine
    testImplementation libs.junitJupiterParams
    testImplementation libs.assertjCore
    testImplementation libs.mockitoCore
    testImplementation libs.mockitoJunitJupiter
}

tasks.register('pitest', JavaExec) {
    group = 'verification'
    description = 'Run PIT Mutation Testing'
    mainClass = 'org.pitest.mutationtest.commandline.MutationCoverageReport'
    classpath = sourceSets.main.runtimeClasspath
    args = [
            '--reportDir', "${buildDir}/reports/pitest",
            '--targetClasses', 'nl.multicode.*',
            '--targetTests', 'nl.multicode.*',
            '--excludedClasses', 'nl.multicode.elevenproof.config.*',
            '--sourceDirs', 'src/main/java',
            '--timestampedReports=false'
    ]
    environment 'PITEST_VERSION', libs.versions.pitestMaven
}

evaluationDependsOn(':generated')
